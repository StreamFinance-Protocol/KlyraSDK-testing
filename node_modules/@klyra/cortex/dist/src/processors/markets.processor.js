"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MarketsProcessor = void 0;
const shared_1 = require("@klyra/shared");
const candles_1 = require("../constants/candles");
const merge_1 = require("../utils/merge");
const market_id_1 = require("../utils/market-id");
class MarketsProcessor {
    constructor(store) {
        this.store = store;
    }
    processSubscribed(msg) {
        const newMarkets = new Map();
        for (const [id, payload] of Object.entries(msg.contents.markets)) {
            const newMarket = this.processSubscribedMarket(id, payload);
            if (newMarket)
                newMarkets.set(id, newMarket);
        }
        const newMarketsObj = Object.fromEntries(newMarkets);
        this.updateMarkets(newMarketsObj);
    }
    processBatchUpdate(msg) {
        const newMarkets = new Map();
        // TODO: change indexer structure so we don't have to do this
        // or check why this is the structure we're receiving
        msg.contents.forEach((partialUpdate) => {
            if (partialUpdate.oraclePrices) {
                for (const [id, payload] of Object.entries(partialUpdate.oraclePrices)) {
                    const newMarket = this.processBatchUpdateMarketOraclePrices(id, payload);
                    if (newMarket)
                        newMarkets.set(id, newMarket);
                }
            }
            if (partialUpdate.trading) {
                for (const [id, payload] of Object.entries(partialUpdate.trading)) {
                    const newMarket = this.processBatchUpdateMarketTrading(id, payload);
                    if (newMarket)
                        newMarkets.set(id, newMarket);
                }
            }
        });
        const newMarketsObj = Object.fromEntries(newMarkets);
        this.updateMarkets(newMarketsObj);
    }
    processSubscribedMarket(id, payload) {
        const existingMarket = this.store.getState().markets[id];
        const newMarket = (0, merge_1.transform)(existingMarket, payload, {
            string: {
                ticker: "market",
            },
            number: {
                spotPrice: "spotPrice",
                priceChange24H: "priceChange24H",
            },
        });
        if (newMarket.market) {
            newMarket.id = newMarket.market;
            const assetId = (0, market_id_1.getAssetIdFromMarketId)(newMarket.market);
            if (assetId)
                newMarket.assetId = assetId;
        }
        else {
            const name = payload.ticker;
            newMarket.market = name;
        }
        newMarket.status = this.calculateMarketStatus(payload.status);
        newMarket.configs = this.calculateMarketConfigs(existingMarket, payload);
        newMarket.perpetual = this.calculatePerpetualMarketInfo(existingMarket, payload, newMarket.spotPrice);
        // TODO: calculate sparkline
        const effectiveIMF = this.calculateEffectiveInitialMarginFraction(newMarket);
        if (effectiveIMF) {
            newMarket.configs.effectiveInitialMarginFraction = effectiveIMF;
        }
        return this.calculateMarket(newMarket);
    }
    processBatchUpdateMarketOraclePrices(id, payload) {
        const existingMarket = this.store.getState().markets[id];
        const newMarket = (0, merge_1.transform)(existingMarket, payload, {
            number: {
                spotPrice: "spotPrice",
            },
        });
        return newMarket;
    }
    processBatchUpdateMarketTrading(id, payload) {
        const existingMarket = this.store.getState().markets[id];
        const transformed = (0, merge_1.transform)(existingMarket, payload, {
            number: {
                spotPrice: "spotPrice",
                price: "spotPrice",
            },
            string: {
                market: "market",
                baseAsset: "assetId",
            },
        });
        const newPerpetual = this.calculatePerpetualMarketInfo(existingMarket, payload, transformed.spotPrice);
        transformed.perpetual = newPerpetual;
        return this.calculateMarket(transformed);
    }
    // --- subcalculations ---
    calculateEffectiveInitialMarginFraction(market) {
        const spotPrice = market.spotPrice;
        const baseIMF = market.configs.initialMarginFraction;
        const openInterest = market.perpetual.openInterest;
        const openInterestLowerCap = market.perpetual.openInterestLowerCap;
        const openInterestUpperCap = market.perpetual.openInterestUpperCap;
        if (!baseIMF)
            return null;
        if (!spotPrice ||
            !openInterest ||
            !openInterestLowerCap ||
            !openInterestUpperCap) {
            return baseIMF;
        }
        if (openInterestLowerCap === openInterestUpperCap)
            return baseIMF;
        const openNotional = openInterest * spotPrice;
        const scalingFactor = openNotional -
            openInterestLowerCap / openInterestUpperCap -
            openInterestLowerCap;
        const imfIncrease = (1 - baseIMF) * scalingFactor;
        const effectiveIMF = Math.min(baseIMF + Math.max(imfIncrease, 0), 1);
        return effectiveIMF;
    }
    calculatePerpetualMarketInfo(existingMarket, payload, spotPrice) {
        const perpetualObj = (0, merge_1.transform)(existingMarket === null || existingMarket === void 0 ? void 0 : existingMarket.perpetual, payload, {
            number: {
                volume24H: "volume24H",
                openInterest: "openInterest",
                openInterestLowerCap: "openInterestLowerCap",
                openInterestUpperCap: "openInterestUpperCap",
                nextFundingRate: "nextFundingRate",
                trades24H: "trades24H",
            },
            datetime: {
                nextFundingAt: "nextFundingAtMilliseconds",
            },
        });
        perpetualObj.openInterestUSDC = perpetualObj.openInterest * spotPrice;
        return perpetualObj;
    }
    calculateMarketConfigs(existingMarket, payload) {
        const configsObj = (0, merge_1.transform)(existingMarket === null || existingMarket === void 0 ? void 0 : existingMarket.configs, payload, {
            string: {
                marketType: "perpetualMarketType",
            },
            number: {
                maintenanceMarginFraction: "maintenanceMarginFraction",
                stepSize: "stepSize",
                tickSize: "tickSize",
                minOrderSize: "minOrderSize",
                initialMarginFraction: "initialMarginFraction",
                maxPositionSize: "maxPositionSize",
                baselinePositionSize: "baselinePositionSize",
                basePositionNotional: "basePositionNotional",
                clobPairId: "clobPairId",
                atomicResolution: "atomicResolution",
                stepBaseQuantums: "stepBaseQuantums",
                quantumConversionExponent: "quantumConversionExponent",
                subticksPerTick: "subticksPerTick",
            },
        });
        const minOrderSize = configsObj.minOrderSize;
        if (!minOrderSize) {
            configsObj.minOrderSize = Number(payload.stepSize);
        }
        configsObj.candleOptions = candles_1.CANDLE_OPTIONS;
        return configsObj;
    }
    calculateMarketStatus(status) {
        switch (status) {
            case shared_1.IndexerPerpetualMarketStatus.ACTIVE:
                return {
                    canTrade: true,
                    canReduce: true,
                };
            case shared_1.IndexerPerpetualMarketStatus.CANCEL_ONLY:
                return {
                    canTrade: false,
                    canReduce: true,
                };
            default:
                return {
                    canTrade: false,
                    canReduce: false,
                };
        }
    }
    updateMarkets(newMarkets) {
        const markets = this.store.getState().markets;
        this.store.setState({
            markets: {
                ...markets,
                ...newMarkets,
            },
        });
    }
    calculateMarket(market) {
        const { priceChange24H, spotPrice } = market;
        const modified = { ...market };
        let percent = null;
        if (priceChange24H === 0)
            percent = 0;
        if (priceChange24H && spotPrice && spotPrice > priceChange24H) {
            const basePrice = spotPrice - priceChange24H;
            if (basePrice > 0)
                percent = priceChange24H / basePrice;
        }
        modified.priceChange24HPercent = percent;
        return modified;
    }
}
exports.MarketsProcessor = MarketsProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2V0cy5wcm9jZXNzb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcHJvY2Vzc29ycy9tYXJrZXRzLnByb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwwQ0FPdUI7QUFFdkIsa0RBQXNEO0FBTXRELDBDQUEyQztBQUMzQyxrREFBNEQ7QUFFNUQsTUFBYSxnQkFBZ0I7SUFHM0IsWUFBWSxLQUFZO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLENBQUM7SUFFTSxpQkFBaUIsQ0FBQyxHQUFtQztRQUMxRCxNQUFNLFVBQVUsR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQztRQUU3QyxLQUFLLE1BQU0sQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDakUsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUM1RCxJQUFJLFNBQVM7Z0JBQUUsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDL0MsQ0FBQztRQUVELE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRU0sa0JBQWtCLENBQUMsR0FBb0M7UUFDNUQsTUFBTSxVQUFVLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7UUFFN0MsNkRBQTZEO1FBQzdELHFEQUFxRDtRQUNyRCxHQUFHLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGFBQWEsRUFBRSxFQUFFO1lBQ3JDLElBQUksYUFBYSxDQUFDLFlBQVksRUFBRSxDQUFDO2dCQUMvQixLQUFLLE1BQU0s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