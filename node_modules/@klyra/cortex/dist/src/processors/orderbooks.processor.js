"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OrderbooksProcessor = void 0;
class OrderbooksProcessor {
    constructor(store) {
        this.store = store;
    }
    processSubscribed(msg) {
        var _a, _b;
        const marketId = msg.id;
        // asks are by default sorted from lowest to highest
        const asks = (_a = msg.contents.asks) === null || _a === void 0 ? void 0 : _a.map((ask) => this.processEntry(ask));
        // bids are by default sorted from highest to lowest
        const bids = (_b = msg.contents.bids) === null || _b === void 0 ? void 0 : _b.map((bid) => this.processEntry(bid));
        const consolidated = this.consolidate(asks, bids);
        if (consolidated) {
            const orderbooks = this.store.getState().orderbooks;
            this.store.setState({
                orderbooks: {
                    ...orderbooks,
                    [marketId]: consolidated,
                },
            });
        }
    }
    // TODO: review this method
    processBatchUpdate(msg) {
        var _a, _b;
        const marketId = msg.id;
        const orderbooks = this.store.getState().orderbooks;
        const orderbook = orderbooks[marketId];
        if (!orderbook)
            return;
        let existingOrderbook = {
            ...orderbook,
        };
        for (const change of msg.contents) {
            const updatedAsks = this.updateOrderbookSide(existingOrderbook, "asks", (_a = change.asks) !== null && _a !== void 0 ? _a : [], true);
            const updatedBids = this.updateOrderbookSide(existingOrderbook, "bids", (_b = change.bids) !== null && _b !== void 0 ? _b : [], false);
            const newOrderbook = this.calculate(updatedAsks, updatedBids);
            if (newOrderbook) {
                existingOrderbook = newOrderbook;
            }
        }
        this.store.setState({
            orderbooks: {
                ...orderbooks,
                [marketId]: existingOrderbook,
            },
        });
    }
    processEntry(entry) {
        return {
            size: Number(entry.size),
            price: Number(entry.price),
        };
    }
    /**
     * Consolidates the orderbook by removing crossed orders and recalculates orderbook metrics.
     *
     * @param asks - The existing market orderbook asks.
     * @param bids - The existing market orderbook bids.
     * @returns The consolidated MarketOrderbook with updated metrics or null if consolidation fails.
     */
    consolidate(asks, bids) {
        var _a, _b;
        const newAsks = asks !== null && asks !== void 0 ? asks : [];
        const newBids = bids !== null && bids !== void 0 ? bids : [];
        // Ensure both asks and bids are present
        if (newAsks.length === 0 || newBids.length === 0) {
            return null;
        }
        const askIndex = 0;
        const bidIndex = 0;
        // Iterate through asks and bids to remove crossed orders
        while (askIndex < newAsks.length && bidIndex < newBids.length) {
            const ask = newAsks[askIndex];
            const bid = newBids[bidIndex];
            // Check if the current ask crosses with the current bid
            if (ask.price <= bid.price) {
                // Determine which order to remove based on offset and size
                const askOffset = (_a = ask.offset) !== null && _a !== void 0 ? _a : 0;
                const bidOffset = (_b = bid.offset) !== null && _b !== void 0 ? _b : 0;
                if (askOffset === bidOffset) {
                    if (ask.size >= bid.size) {
                        newBids.splice(bidIndex, 1);
                    }
                    else {
                        newAsks.splice(askIndex, 1);
                    }
                }
                else if (askOffset > bidOffset) {
                    newBids.splice(bidIndex, 1);
                }
                else {
                    newAsks.splice(askIndex, 1);
                }
            }
            else {
                // No crossing, move to the next ask or bid
                break;
            }
        }
        // Recalculate the orderbook metrics after consolidation
        const consolidatedOrderbook = this.calculate(newAsks, newBids);
        return consolidatedOrderbook;
    }
    calculate(asks, bids) {
        var _a, _b;
        if (!asks || !bids || asks.length === 0 || bids.length === 0) {
            return null;
        }
        let asksDepth = 0;
        const modifiedAsks = asks.map((ask) => {
            const { size, price } = ask;
            asksDepth += size;
            const depth = asksDepth;
            const sizeCost = size * price;
            const orderbookEntry = {
                ...ask,
                depth,
                sizeCost,
                // TODO: calculate offset or see if we need to calculate it at all
                offset: 0,
            };
            return orderbookEntry;
        });
        let bidsDepth = 0;
        const modifiedBids = bids.map((bid) => {
            const { size, price } = bid;
            bidsDepth += size;
            const depth = bidsDepth;
            const sizeCost = size * price;
            const orderbookEntry = {
                ...bid,
                depth,
                sizeCost,
                // TODO: calculate offset or see if we need to calculate it at all
                offset: 0,
            };
            return orderbookEntry;
        });
        const firstAskPrice = (_a = modifiedAsks[0]) === null || _a === void 0 ? void 0 : _a.price;
        const firstBidPrice = (_b = modifiedBids[0]) === null || _b === void 0 ? void 0 : _b.price;
        const orderbook = {
            asks: modifiedAsks,
            bids: modifiedBids,
            midPrice: null,
            spreadPercent: null,
            spread: null,
        };
        if (firstAskPrice && firstBidPrice) {
            orderbook.midPrice = (firstAskPrice + firstBidPrice) / 2;
            const spread = firstAskPrice - firstBidPrice;
            orderbook.spread = spread;
            orderbook.spreadPercent = spread / orderbook.midPrice;
        }
        return orderbook;
    }
    updateOrderbookSide(existingOrderbook, side, changes, isAscending) {
        const comparator = (a, b) => isAscending ? a.price - b.price : b.price - a.price;
        const updatedSide = [...existingOrderbook[side]];
        for (const [price, size] of changes) {
            const newSize = parseFloat(size);
            const newPrice = parseFloat(price);
            if (isNaN(newSize) || isNaN(newPrice))
                continue;
            const index = updatedSide.findIndex((entry) => entry.price === newPrice);
            if (index !== -1) {
                if (newSize === 0) {
                    updatedSide.splice(index, 1);
                }
                else {
                    updatedSide[index] = {
                        ...updatedSide[index],
                        size: newSize,
                        price: newPrice,
                        sizeCost: newSize * newPrice,
                        offset: 0,
                        depth: 0,
                    };
                }
            }
            else if (newSize !== 0) {
                const newEntry = {
                    size: newSize,
                    price: newPrice,
                    depth: 0,
                    sizeCost: newSize * newPrice,
                    offset: 0, // TODO: Implement offset calculation if needed
                };
                updatedSide.push(newEntry);
                updatedSide.sort(comparator);
            }
        }
        // Recalculate depth
        let cumulativeDepth = 0;
        return updatedSide.map((entry) => {
            cumulativeDepth += entry.size;
            return { ...entry, depth: cumulativeDepth };
        });
    }
}
exports.OrderbooksProcessor = OrderbooksProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXJib29rcy5wcm9jZXNzb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcHJvY2Vzc29ycy9vcmRlcmJvb2tzLnByb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFjQSxNQUFhLG1CQUFtQjtJQUc5QixZQUFZLEtBQVk7UUFDdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDckIsQ0FBQztJQUVNLGlCQUFpQixDQUFDLEdBQXNDOztRQUM3RCxNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUMsRUFBRyxDQUFDO1FBRXpCLG9EQUFvRDtRQUNwRCxNQUFNLElBQUksR0FBRyxNQUFBLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSwwQ0FBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNyRSxvREFBb0Q7UUFDcEQsTUFBTSxJQUFJLEdBQUcsTUFBQSxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksMENBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFckUsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbEQsSUFBSSxZQUFZLEVBQUUsQ0FBQztZQUNqQixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNwRCxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQztnQkFDbEIsVUFBVSxFQUFFO29CQUNWLEdBQUcsVUFBVTtvQkFDYixDQUFDLFFBQVEsQ0FBQyxFQUFFLFlBQVk7aUJBQ3pCO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUM7SUFFRCwyQkFBMkI7SUFD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