"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FillsProcessor = void 0;
const indexer_conversion_1 = require("../../utils/indexer-conversion");
class FillsProcessor {
    constructor(store) {
        this.store = store;
    }
    process(existing, payload, subaccountNumber) {
        if (!payload)
            return [];
        const newFills = payload.map((fill) => this.processFill(fill, subaccountNumber));
        const result = new Set([...existing, ...newFills]);
        const resultsArray = Array.from(result).filter((fill) => fill !== null);
        return resultsArray;
    }
    processFill(fill, subaccountNumber) {
        if (!fill.id)
            return null;
        return {
            id: fill.id,
            marketId: fill.ticker,
            orderId: fill.orderId,
            subaccountNumber,
            marginMode: (0, indexer_conversion_1.getMarginModeFromSubaccount)(subaccountNumber),
            side: (0, indexer_conversion_1.convertIndexerOrderSide)(fill.side),
            type: (0, indexer_conversion_1.convertIndexerOrderType)(fill.type),
            liquidity: (0, indexer_conversion_1.convertIndexerLiquidity)(fill.liquidity),
            price: Number(fill.price),
            size: Number(fill.size),
            fee: Number(fill.fee),
            createdAtMilliseconds: new Date(fill.createdAt).getTime(),
        };
    }
}
exports.FillsProcessor = FillsProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsbHMucHJvY2Vzc29yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3Byb2Nlc3NvcnMvYWNjb3VudC9maWxscy5wcm9jZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBR0EsdUVBS3dDO0FBRXhDLE1BQWEsY0FBYztJQUd6QixZQUFZLEtBQVk7UUFDdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDckIsQ0FBQztJQUVNLE9BQU8sQ0FDWixRQUEwQixFQUMxQixPQUE0QyxFQUM1QyxnQkFBd0I7UUFFeEIsSUFBSSxDQUFDLE9BQU87WUFBRSxPQUFPLEVBQUUsQ0FBQztRQUV4QixNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FDcEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsQ0FDekMsQ0FBQztRQUVGLE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxRQUFRLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUM1QyxDQUFDLElBQUksRUFBMEIsRUFBRSxDQUFDLElBQUksS0FBSyxJQUFJLENBQ2hELENBQUM7UUFFRixPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBRU8sV0FBVyxDQUNqQixJQUEyQixFQUMzQixnQkFBd0I7UUFFeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFFMUIsT0FBTztZQUNMLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtZQUNYLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTTtZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87WUFDckIsZ0JBQWdCO1lBQ2hCLFVBQVUsRUFBRSxJQUFBLGdEQUEyQixFQUFDLGdCQUFnQixDQUFDO1lBQ3pELElBQUksRUFBRSxJQUFBLDRDQUF1QixFQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDeEMsSUFBSSxFQUFFLElBQUEsNENBQXVCLEVBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztZQUN4QyxTQUFTLEVBQUUsSUFBQSw0Q0FBdUIsRUFBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ2xELEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUN6QixJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDdkIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO1lBQ3JCLHFCQUFxQixFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLEVBQUU7U0FDMUQsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQS9DRCx3Q0ErQ0MifQ==