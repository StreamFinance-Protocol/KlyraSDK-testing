"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TransfersProcessor = void 0;
const merge_1 = require("../../utils/merge");
class TransfersProcessor {
    constructor(store) {
        this.store = store;
    }
    process(existing, payload) {
        if (!payload)
            return [];
        const newTransfers = payload.map((item) => {
            const id = item.transactionHash;
            return this.processTransfer(existing.find((transfer) => transfer.transactionHash === id), item);
        });
        return newTransfers;
    }
    processTransfer(existing, newItem) {
        // TODO: review types for transform
        const modified = (0, merge_1.transform)(existing, newItem, {
            string: {
                id: "id",
                type: "type",
                symbol: "asset",
                fromAddress: "fromAddress",
                toAddress: "toAddress",
                senderWallet: "fromAddress",
                recipientWallet: "toAddress",
                transactionHash: "transactionHash",
            },
            number: {
                size: "amount",
                createdAtHeight: "updatedAtBlock",
            },
        });
        const { sender, recipient } = newItem;
        modified.fromAddress = sender.address;
        modified.toAddress = recipient.address;
        if (!modified.id) {
            modified.id = newItem.transactionHash;
        }
        return modified;
    }
}
exports.TransfersProcessor = TransfersProcessor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmZXJzLnByb2Nlc3Nvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wcm9jZXNzb3JzL2FjY291bnQvdHJhbnNmZXJzLnByb2Nlc3Nvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFHQSw2Q0FBOEM7QUFFOUMsTUFBYSxrQkFBa0I7SUFHN0IsWUFBWSxLQUFZO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLENBQUM7SUFFTSxPQUFPLENBQ1osUUFBOEIsRUFDOUIsT0FBZ0Q7UUFFaEQsSUFBSSxDQUFDLE9BQU87WUFBRSxPQUFPLEVBQUUsQ0FBQztRQUV4QixNQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDeEMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztZQUNoQyxPQUFPLElBQUksQ0FBQyxlQUFlLENBQ3pCLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxlQUFlLEtBQUssRUFBRSxDQUFDLEVBQzVELElBQUksQ0FDTCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBRU8sZUFBZSxDQUNyQixRQUF3QyxFQUN4QyxPQUFrQztRQUVsQyxtQ0FBbUM7UUFDbkMsTUFBTSxRQUFRLEdBQUcsSUFBQSxpQkFBUyxFQUFxQixRQUFRLEVBQUUsT0FBTyxFQUFFO1lBQ2hFLE1BQU0sRUFBRTtnQkFDTixFQUFFLEVBQUUsSUFBSTtnQkFDUixJQUFJLEVBQUUsTUFBTTtnQkFDWixNQUFNLEVBQUUsT0FBTztnQkFDZixXQUFXLEVBQUUsYUFBYTtnQkFDMUIsU0FBUyxFQUFFLFdBQVc7Z0JBQ3RCLFlBQVksRUFBRSxhQUFhO2dCQUMzQixlQUFlLEVBQUUsV0FBVztnQkFDNUIsZUFBZSxFQUFFLGlCQUFpQjthQUNuQztZQUNELE1BQU0sRUFBRTtnQkFDTixJQUFJLEVBQUUsUUFBUTtnQkFDZCxlQUFlLEVBQUUsZ0JBQWdCO2FBQ2xDO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxPQUFPLENBQUM7UUFFdEMsUUFBUSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ3RDLFFBQVEsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQztRQUV2QyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxFQUFFLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQztRQUN4QyxDQUFDO1FBRUQsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztDQUNGO0FBekRELGdEQXlEQyJ9