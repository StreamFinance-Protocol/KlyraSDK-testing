"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const store_1 = require("../core/store");
const orderbooks_processor_1 = require("../processors/orderbooks.processor");
const mocks_1 = require("./mocks");
(0, globals_1.describe)("OrderbookProcessor", () => {
    let store;
    let orderbookProcessor;
    (0, globals_1.beforeAll)(() => {
        store = new store_1.Store();
        orderbookProcessor = new orderbooks_processor_1.OrderbooksProcessor(store);
    });
    (0, globals_1.it)("should be defined", () => {
        (0, globals_1.expect)(orderbooks_processor_1.OrderbooksProcessor).toBeDefined();
    });
    (0, globals_1.it)("should process incoming orderbook", () => {
        var _a, _b, _c, _d;
        orderbookProcessor.processSubscribed(mocks_1.OrderbookMocks.SUBSCRIBED_MESSAGE);
        const orderbook = store.getState().orderbooks;
        const marketOrderbook = orderbook["ETH-USD"];
        (0, globals_1.expect)(marketOrderbook).toBeDefined();
        (0, globals_1.expect)(marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks.length).toBe(10);
        (0, globals_1.expect)(marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids.length).toBe(10);
        (0, globals_1.expect)((_a = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks[0]) === null || _a === void 0 ? void 0 : _a.price).toBe(2629.9);
        (0, globals_1.expect)((_b = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks[0]) === null || _b === void 0 ? void 0 : _b.size).toBe(0.415);
        (0, globals_1.expect)((_c = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids[0]) === null || _c === void 0 ? void 0 : _c.price).toBe(2613.6);
        (0, globals_1.expect)((_d = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids[0]) === null || _d === void 0 ? void 0 : _d.size).toBe(0.415);
    });
    (0, globals_1.it)("should process batch update", () => {
        var _a, _b, _c, _d, _e, _f, _g, _h;
        orderbookProcessor.processBatchUpdate(mocks_1.OrderbookMocks.BATCH_UPDATE_MESSAGE);
        const orderbook = store.getState().orderbooks;
        const marketOrderbook = orderbook["ETH-USD"];
        (0, globals_1.expect)(marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks.length).toBe(11);
        (0, globals_1.expect)(marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids.length).toBe(11);
        // These are the updated orderbook entries
        (0, globals_1.expect)((_a = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks[1]) === null || _a === void 0 ? void 0 : _a.price).toBe(2629.9);
        (0, globals_1.expect)((_b = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks[1]) === null || _b === void 0 ? void 0 : _b.size).toBe(140);
        (0, globals_1.expect)((_c = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids[1]) === null || _c === void 0 ? void 0 : _c.price).toBe(2613.6);
        (0, globals_1.expect)((_d = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids[1]) === null || _d === void 0 ? void 0 : _d.size).toBe(140);
        // These are the new orderbook entries
        (0, globals_1.expect)((_e = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks[0]) === null || _e === void 0 ? void 0 : _e.price).toBe(32);
        (0, globals_1.expect)((_f = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.asks[0]) === null || _f === void 0 ? void 0 : _f.size).toBe(100);
        (0, globals_1.expect)((_g = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids[0]) === null || _g === void 0 ? void 0 : _g.price).toBe(26032);
        (0, globals_1.expect)((_h = marketOrderbook === null || marketOrderbook === void 0 ? void 0 : marketOrderbook.bids[0]) === null || _h === void 0 ? void 0 : _h.size).toBe(100);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXJib29rLXByb2Nlc3Nvci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL19fdGVzdHNfXy9vcmRlcmJvb2stcHJvY2Vzc29yLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FBZ0U7QUFDaEUseUNBQXNDO0FBQ3RDLDZFQUF5RTtBQUN6RSxtQ0FBeUM7QUFFekMsSUFBQSxrQkFBUSxFQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyxJQUFJLEtBQVksQ0FBQztJQUNqQixJQUFJLGtCQUF1QyxDQUFDO0lBRTVDLElBQUEsbUJBQVMsRUFBQyxHQUFHLEVBQUU7UUFDYixLQUFLLEdBQUcsSUFBSSxhQUFLLEVBQUUsQ0FBQztRQUNwQixrQkFBa0IsR0FBRyxJQUFJLDBDQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3RELENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxZQUFFLEVBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQzNCLElBQUEsZ0JBQU0sRUFBQywwQ0FBbUIsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxZQUFFLEVBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFOztRQUMzQyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxzQkFBYyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFeEUsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLFVBQVUsQ0FBQztRQUM5QyxNQUFNLGVBQWUsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDN0MsSUFBQSxnQkFBTSxFQUFDLGVBQWUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3RDLElBQUEsZ0JBQU0sRUFBQyxlQUFlLGFBQWYsZUFBZSx1QkFBZixlQUFlLENBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENB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