"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const store_1 = require("../core/store");
const trades_processor_1 = require("../processors/trades.processor");
const mocks_1 = require("./mocks");
(0, globals_1.describe)("TradesProcessor", () => {
    let store;
    let tradesProcessor;
    (0, globals_1.beforeAll)(() => {
        store = new store_1.Store();
        tradesProcessor = new trades_processor_1.TradesProcessor(store);
    });
    (0, globals_1.it)("should be defined", () => {
        (0, globals_1.expect)(trades_processor_1.TradesProcessor).toBeDefined();
    });
    (0, globals_1.it)("should process trades", () => {
        var _a, _b, _c, _d;
        tradesProcessor.processSubscribed(mocks_1.TradesMocks.SUBSCRIBED_MESSAGE);
        const trades = store.getState().trades;
        const marketTrades = trades["ETH-USD"];
        (0, globals_1.expect)(marketTrades).toBeDefined();
        (0, globals_1.expect)(marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades.length).toBe(10);
        (0, globals_1.expect)((_a = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[0]) === null || _a === void 0 ? void 0 : _a.id).toBe("014a8f900000000200000014");
        (0, globals_1.expect)((_b = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[0]) === null || _b === void 0 ? void 0 : _b.side).toBe("BUY");
        (0, globals_1.expect)((_c = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[0]) === null || _c === void 0 ? void 0 : _c.size).toBe(0.002);
        (0, globals_1.expect)((_d = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[0]) === null || _d === void 0 ? void 0 : _d.price).toBe(2632.6);
    });
    (0, globals_1.it)("should process batch update", () => {
        var _a, _b, _c, _d;
        const previousTrades = store.getState().trades;
        const previousMarketTrades = previousTrades["ETH-USD"];
        (0, globals_1.expect)(previousMarketTrades).toBeDefined();
        (0, globals_1.expect)(previousMarketTrades === null || previousMarketTrades === void 0 ? void 0 : previousMarketTrades.length).toBe(10);
        tradesProcessor.processBatchUpdate(mocks_1.TradesMocks.BATCH_UPDATE_MESSAGE);
        const trades = store.getState().trades;
        const marketTrades = trades["ETH-USD"];
        (0, globals_1.expect)(marketTrades).toBeDefined();
        (0, globals_1.expect)(marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades.length).toBe(11);
        (0, globals_1.expect)((_a = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[10]) === null || _a === void 0 ? void 0 : _a.id).toBe("014a968f0000000200000005");
        (0, globals_1.expect)((_b = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[10]) === null || _b === void 0 ? void 0 : _b.side).toBe("BUY");
        (0, globals_1.expect)((_c = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[10]) === null || _c === void 0 ? void 0 : _c.size).toBe(0.002);
        (0, globals_1.expect)((_d = marketTrades === null || marketTrades === void 0 ? void 0 : marketTrades[10]) === null || _d === void 0 ? void 0 : _d.price).toBe(2634.1);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhZGVzLXByb2Nlc3Nvci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL19fdGVzdHNfXy90cmFkZXMtcHJvY2Vzc29yLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FBZ0U7QUFDaEUseUNBQXNDO0FBQ3RDLHFFQUFpRTtBQUNqRSxtQ0FBc0M7QUFFdEMsSUFBQSxrQkFBUSxFQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLEtBQVksQ0FBQztJQUNqQixJQUFJLGVBQWdDLENBQUM7SUFFckMsSUFBQSxtQkFBUyxFQUFDLEdBQUcsRUFBRTtRQUNiLEtBQUssR0FBRyxJQUFJLGFBQUssRUFBRSxDQUFDO1FBQ3BCLGVBQWUsR0FBRyxJQUFJLGtDQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLFlBQUUsRUFBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDM0IsSUFBQSxnQkFBTSxFQUFDLGtDQUFlLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUN4QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsWUFBRSxFQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTs7UUFDL0IsZUFBZSxDQUFDLGlCQUFpQixDQUFDLG1CQUFXLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUVsRSxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsTUFBTSxDQUFDO1FBQ3ZDLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN2QyxJQUFBLGdCQUFNLEVBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbkMsSUFBQSxnQkFBTSxFQUFDLFlBQVksYUFBWixZQUFZLHVCQUFaLFlBQVksQ0FBRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDdEMsSUFBQSxnQkFBTSxFQUFDLE1BQUEsWUFBWSxhQUFaLFlBQVksdUJBQVosWUFBWSxDQUFHLENBQUMsQ0FBQywwQ0FBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUMvRCxJQUFBLGdCQUFNLEVBQUMsTUFBQSxZQUFZLGFBQVosWUFBWSx1QkFBWixZQUFZLENBQUcsQ0FBQyxDQUFDLDBDQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QyxJQUFBLGdCQUFNLEVBQUMsTUFBQSxZQUFZLGFBQVosWUFBWSx1QkFBWixZQUFZLENBQUcsQ0FBQyxDQUFDLDBDQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QyxJQUFBLGdCQUFNLEVBQUMsTUFBQSxZQUFZLGFBQVosWUFBWSx1QkFBWixZQUFZLENBQUcsQ0FBQyxDQUFDLDBDQUFFLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsWUFBRSxFQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTs7UUFDckMsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLE1BQU0sQ0FBQztRQUMvQyxNQUFNLG9CQUFvQixHQUFHLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN2RCxJQUFBLGdCQUFNLEVBQUMsb0JBQW9CLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzQyxJQUFBLGdCQUFNLEVBQUMsb0JBQW9CLGFBQXBCLG9CQUFvQix1QkFBcEIsb0JBQW9CLENBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTlDLGVBQWUsQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBVyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFckUsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLE1BQU0sQ0FBQztRQUN2QyxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkMsSUFBQSxnQkFBTSxFQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25DLElBQUEsZ0JBQU0sRUFBQyxZQUFZLGFBQVosWUFBWSx1QkFBWixZQUFZLENBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLElBQUEsZ0JBQU0sRUFBQyxNQUFBLFlBQVksYUFBWixZQUFZLHVCQUFaLFlBQVksQ0FBRyxFQUFFLENBQUMsMENBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDaEUsSUFBQSxnQkFBTSxFQUFDLE1BQUEsWUFBWSxhQUFaLFlBQVksdUJBQVosWUFBWSxDQUFHLEVBQUUsQ0FBQywwQ0FBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0MsSUFBQSxnQkFBTSxFQUFDLE1BQUEsWUFBWSxhQUFaLFlBQVksdUJBQVosWUFBWSxDQUFHLEVBQUUsQ0FBQywwQ0FBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0MsSUFBQSxnQkFBTSxFQUFDLE1BQUEsWUFBWSxhQUFaLFlBQVksdUJBQVosWUFBWSxDQUFHLEVBQUUsQ0FBQywwQ0FBRSxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDakQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyJ9