"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Store = void 0;
const shared_1 = require("@klyra/shared");
const values_1 = require("../processors/forms/trade/values");
const forms_1 = require("../types/forms");
// TODO: add chain info (block height)
const DEFAULT_STATE = {
    forms: {
        [forms_1.FormType.TRADE]: values_1.DEFAULT_TRADE_FORM_STATE,
        [forms_1.FormType.DEPOSIT]: {
            inputs: {
                amount: 0,
                assetId: "",
            },
            postResults: {},
            errors: {},
            summary: null,
            options: null,
        },
        [forms_1.FormType.WITHDRAW]: {
            inputs: {
                amount: 0,
                assetId: "",
            },
            postResults: {},
            errors: {},
            summary: null,
            options: null,
        },
        [forms_1.FormType.TRANSFER]: {
            inputs: {
                amount: 0,
                assetId: "",
            },
            postResults: {},
            errors: {},
            summary: null,
            options: null,
        },
        [forms_1.FormType.CLOSE_POSITION]: {
            inputs: {
                amount: 0,
                assetId: "",
            },
            postResults: {},
            errors: {},
            summary: null,
            options: null,
        },
    },
    user: {
        wallet: null,
        account: {
            subaccounts: {},
            balances: {},
        },
        feeTier: {
            feeTierId: "",
            makerFeeRate: 0,
            takerFeeRate: 0,
            makerVolume30D: 0,
            takerVolume30D: 0,
        },
        address: null,
        subaccountNumber: 0,
    },
    markets: {},
    candles: {},
    orderbooks: {},
    historicalFundings: {},
    trades: {},
    chartConfigs: {
        resolution: "",
    },
    currentMarketTicker: undefined,
};
class Store {
    constructor(initialState = {}) {
        this.state = { ...DEFAULT_STATE, ...initialState };
        this.eventEmitter = new shared_1.EventEmitter();
    }
    getState() {
        return this.state;
    }
    setState(newState) {
        const oldState = this.state;
        this.state = { ...this.state, ...newState };
        this.eventEmitter.emit("stateChange", this.state, oldState);
    }
    subscribe(listener) {
        this.eventEmitter.on("stateChange", listener);
        return () => {
            this.eventEmitter.off("stateChange", listener);
        };
    }
    select(selector) {
        return selector(this.state);
    }
    resetState(newState = {}) {
        this.state = { ...DEFAULT_STATE, ...newState };
        this.eventEmitter.emit("stateChange", this.state, null);
    }
}
exports.Store = Store;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29yZS9zdG9yZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwwQ0FBNkM7QUFDN0MsNkRBQTRFO0FBQzVFLDBDQUEwQztBQUcxQyxzQ0FBc0M7QUFDdEMsTUFBTSxhQUFhLEdBQWU7SUFDaEMsS0FBSyxFQUFFO1FBQ0wsQ0FBQyxnQkFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLGlDQUF3QjtRQUMxQyxDQUFDLGdCQUFRLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDbEIsTUFBTSxFQUFFO2dCQUNOLE1BQU0sRUFBRSxDQUFDO2dCQUNULE9BQU8sRUFBRSxFQUFFO2FBQ1o7WUFDRCxXQUFXLEVBQUUsRUFBRTtZQUNmLE1BQU0sRUFBRSxFQUFFO1lBQ1YsT0FBTyxFQUFFLElBQUk7WUFDYixPQUFPLEVBQUUsSUFBSTtTQUNkO1FBQ0QsQ0FBQyxnQkFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ25CLE1BQU0sRUFBRTtnQkFDTixNQUFNLEVBQUUsQ0FBQztnQkFDVCxPQUFPLEVBQUUsRUFBRTthQUNaO1lBQ0QsV0FBVyxFQUFFLEVBQUU7WUFDZixNQUFNLEVBQUUsRUFBRTtZQUNWLE9BQU8sRUFBRSxJQUFJO1lBQ2IsT0FBTyxFQUFFLElBQUk7U0FDZDtRQUNELENBQUMsZ0JBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUNuQixNQUFNLEVBQUU7Z0JBQ04sTUFBTSxFQUFFLENBQUM7Z0JBQ1QsT0FBTyxFQUFFLEVBQUU7YUFDWjtZQUNELFdBQVcsRUFBRSxFQUFFO1lBQ2YsTUFBTSxFQUFFLEVBQUU7WUFDVixPQUFPLEVBQUUsSUFBSTtZQUNiLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRCxDQUFDLGdCQUFRLENBQUMsY0FBYyxDQUFDLEVBQUU7WUFDekIsTUFBTSxFQUFFO2dCQUNOLE1BQU0sRUFBRSxDQUFDO2dCQUNULE9BQU8sRUFBRSxFQUFFO2FBQ1o7WUFDRCxXQUFXLEVBQUUsRUFBRTtZQUNmLE1BQU0sRUFBRSxFQUFFO1lBQ1YsT0FBTyxFQUFFLElBQUk7WUFDYixPQUFPLEVBQUUsSUFBSTtTQUNkO0tBQ0Y7SUFDRCxJQUFJLEVBQUU7UUFDSixNQUFNLEVBQUUsSUFBSTtRQUNaLE9BQU8sRUFBRTtZQUNQLFdBQVcsRUFBRSxFQUFFO1lBQ2YsUUFBUSxFQUFFLEVBQUU7U0FDYjtRQUNELE9BQU8sRUFBRTtZQUNQLFNBQVMsRUFBRSxFQUFFO1lBQ2IsWUFBWSxFQUFFLENBQUM7WUFDZixZQUFZLEVBQUUsQ0FBQztZQUNmLGNBQWMsRUFBRSxDQUFDO1lBQ2pCLGNBQWMsRUFBRSxDQUFDO1NBQ2xCO1FBQ0QsT0FBTyxFQUFFLElBQUk7UUFDYixnQkFBZ0IsRUFBRSxDQUFDO0tBQ3BCO0lBQ0QsT0FBTyxFQUFFLEVBQUU7SUFDWCxPQUFPLEVBQUUsRUFBRTtJQUNYLFVBQVUsRUFBRSxFQUFFO0lBQ2Qsa0JBQWtCLEVBQUUsRUFBRTtJQUN0QixNQUFNLEVBQUUsRUFBRTtJQUVWLFlBQVksRUFBRTtRQUNaLFVBQVUsRUFBRSxFQUFFO0tBQ2Y7SUFFRCxtQkFBbUIsRUFBRSxTQUFTO0NBQy9CLENBQUM7QUFFRixNQUFhLEtBQUs7SUFJaEIsWUFBWSxlQUFvQyxFQUFFO1FBQ2hELElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxHQUFHLGFBQWEsRUFBRSxHQUFHLFlBQVksRUFBRSxDQUFDO1FBQ25ELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxxQkFBWSxFQUFFLENBQUM7SUFDekMsQ0FBQztJQUVELFFBQVE7UUFDTixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDcEIsQ0FBQztJQUVELFFBQVEsQ0FBQyxRQUE2QjtRQUNwQyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQzVCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxRQUFRLEVBQUUsQ0FBQztRQUM1QyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQsU0FBUyxDQUFDLFFBQTZCO1FBQ3JDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUU5QyxPQUFPLEdBQUcsRUFBRTtZQUNWLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUM7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFJLFFBQWtDO1FBQzFDLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsVUFBVSxDQUFDLFdBQWdDLEVBQUU7UUFDM0MsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLEdBQUcsYUFBYSxFQUFFLEdBQUcsUUFBUSxFQUFnQixDQUFDO1FBQzdELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzFELENBQUM7Q0FDRjtBQW5DRCxzQkFtQ0MifQ==