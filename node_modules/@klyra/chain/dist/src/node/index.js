"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const tendermint_rpc_1 = require("@cosmjs/tendermint-rpc");
const stargate_1 = require("@cosmjs/stargate");
const tendermint_1 = require("../lib/tendermint");
const constants_1 = require("../constants");
const node_get_1 = __importDefault(require("./node-get"));
const node_post_1 = __importDefault(require("./node-post"));
class NodeClient {
    constructor(config) {
        this.config = config;
    }
    async initialize() {
        var _a, _b, _c, _d;
        const tendermint37Client = await tendermint_rpc_1.Tendermint37Client.connect(this.config.restUrl);
        const broadcastOptions = {
            pollIntervalMs: (_b = (_a = this.config.broadcastOptions) === null || _a === void 0 ? void 0 : _a.pollIntervalMs) !== null && _b !== void 0 ? _b : constants_1.DEFAULT_BROADCAST_OPTIONS.pollIntervalMs,
            timeoutMs: (_d = (_c = this.config.broadcastOptions) === null || _c === void 0 ? void 0 : _c.timeoutMs) !== null && _d !== void 0 ? _d : constants_1.DEFAULT_BROADCAST_OPTIONS.timeoutMs,
        };
        const tendermintClient = new tendermint_1.TendermintClient(tendermint37Client, broadcastOptions);
        const queryClient = stargate_1.QueryClient.withExtensions(tendermint37Client, stargate_1.setupTxExtension);
        this._get = new node_get_1.default(tendermintClient, queryClient);
        this._post = new node_post_1.default(this._get, this.config.chainId, this.config.defaultClientMemo, this.config.useTimestampNonce);
    }
    get get() {
        if (!this._get) {
            throw new Error("Get module not initialized in NodeClient.");
        }
        return this._get;
    }
    get post() {
        if (!this._post) {
            throw new Error("Post module not initialized in NodeClient.");
        }
        return this._post;
    }
    /**
     * @description populate account number cache in the Post module for performance.
     */
    async populateAccountNumberCache(address) {
        if (!this._post) {
            throw new Error("Post module not initialized in NodeClient.");
        }
        await this._post.populateAccountNumberCache(address);
    }
}
exports.default = NodeClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbm9kZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDJEQUE0RDtBQUM1RCwrQ0FBaUU7QUFFakUsa0RBQXFEO0FBQ3JELDRDQUF5RDtBQUN6RCwwREFBaUM7QUFDakMsNERBQW1DO0FBRW5DLE1BQXFCLFVBQVU7SUFLN0IsWUFBWSxNQUF3QjtRQUNsQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQsS0FBSyxDQUFDLFVBQVU7O1FBQ2QsTUFBTSxrQkFBa0IsR0FBRyxNQUFNLG1DQUFrQixDQUFDLE9BQU8sQ0FDekQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQ3BCLENBQUM7UUFDRixNQUFNLGdCQUFnQixHQUFHO1lBQ3ZCLGNBQWMsRUFDWixNQUFBLE1BQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsMENBQUUsY0FBYyxtQ0FDNUMscUNBQXlCLENBQUMsY0FBYztZQUMxQyxTQUFTLEVBQ1AsTUFBQSxNQUFBLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLDBDQUFFLFNBQVMsbUNBQ3ZDLHFDQUF5QixDQUFDLFNBQVM7U0FDdEMsQ0FBQztRQUVGLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSw2QkFBZ0IsQ0FDM0Msa0JBQWtCLEVBQ2xCLGdCQUFnQixDQUNqQixDQUFDO1FBRUYsTUFBTSxXQUFXLEdBQUcsc0JBQVcsQ0FBQyxjQUFjLENBQzVDLGtCQUFrQixFQUNsQiwyQkFBZ0IsQ0FDakIsQ0FBQztRQUVGLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxrQkFBTyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxtQkFBUSxDQUN2QixJQUFJLENBQUMsSUFBSSxFQUNULElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUM5QixDQUFDO0lBQ0osQ0FBQztJQUVELElBQUksR0FBRztRQUNMLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDZixNQUFNLElBQUksS0FBSyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztJQUNuQixDQUFDO0lBRUQsSUFBSSxJQUFJO1FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNoQixNQUFNLElBQUksS0FBSyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7UUFDaEUsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsMEJBQTBCLENBQUMsT0FBZTtRQUM5QyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2hCLE1BQU0sSUFBSSxLQUFLLENBQUMsNENBQTRDLENBQUMsQ0FBQztRQUNoRSxDQUFDO1FBQ0QsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLDBCQUEwQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZELENBQUM7Q0FDRjtBQWhFRCw2QkFnRUMifQ==